<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products | KComputers</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- COPY OF GLOBAL STYLES --- */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { color: #4a5568; line-height: 1.6; background-color: #f8fafc; display: flex; flex-direction: column; min-height: 100vh; }
        a { text-decoration: none; }
        ul { list-style: none; }

        /* --- HEADER --- */
        header { background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        nav { max-width: 1200px; margin: 0 auto; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .logo { font-size: 1.5rem; font-weight: bold; color: #0a2342; margin-right: 20px; }
        .nav-group { display: flex; align-items: center; gap: 20px; }
        .nav-links { display: flex; gap: 25px; }
        .nav-links a { color: #4a5568; font-weight: 500; font-size: 1rem; transition: color 0.3s; }
        .nav-links a:hover, .nav-links a.active { color: #00b4d8; }

        /* --- SEARCH --- */
        .search-box { position: relative; }
        .search-box input { padding: 8px 15px; padding-right: 35px; border: 1px solid #cbd5e1; border-radius: 20px; outline: none; font-size: 0.9rem; width: 200px; transition: width 0.3s, border-color 0.3s; }
        .search-box input:focus { border-color: #00b4d8; width: 240px; }
        .search-box i { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #94a3b8; pointer-events: none; }

        /* --- AUTH BUTTONS --- */
        .login-btn { background: none; border: 1px solid #cbd5e1; padding: 5px 15px; border-radius: 4px; cursor: pointer; color: #64748b; font-size: 0.9rem; transition: all 0.3s; }
        .login-btn:hover { border-color: #00b4d8; color: #00b4d8; }
        .logout-btn { background-color: #ef4444; color: white; border: none; display: none; }
        .logout-btn:hover { background-color: #dc2626; }

        /* --- MAIN LAYOUT --- */
        section { padding: 40px 20px; max-width: 1200px; margin: 0 auto; width: 100%; flex: 1; }
        .page-title { text-align: center; font-size: 2.5rem; color: #0a2342; margin-bottom: 40px; }

        /* --- ADMIN PANEL --- */
        .admin-panel { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); margin-bottom: 40px; border-top: 4px solid #00b4d8; display: none; }
        .admin-panel.visible { display: block; animation: fadeIn 0.5s; }
        .input-group { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .input-group input { padding: 12px; border: 1px solid #cbd5e1; border-radius: 6px; flex: 1; min-width: 200px; }
        .btn-add { background-color: #00b4d8; color: white; padding: 12px 30px; border-radius: 6px; font-weight: bold; cursor: pointer; border: none; transition: background 0.3s; }
        .btn-add:hover { background-color: #0096c7; }

        /* --- GRID --- */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        .product-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); transition: transform 0.3s; position: relative; display: flex; flex-direction: column; }
        .product-card:hover { transform: translateY(-5px); }
        .product-img { height: 200px; background-color: #e2e8f0; display: flex; align-items: center; justify-content: center; color: #94a3b8; font-size: 4rem; }
        .product-info { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        .product-title { font-size: 1.25rem; color: #0a2342; margin-bottom: 8px; }
        .product-desc { font-size: 0.95rem; color: #64748b; margin-bottom: 15px; flex: 1; }
        .product-footer { display: flex; justify-content: space-between; align-items: center; margin-top: auto; border-top: 1px solid #f1f5f9; padding-top: 15px; }
        .product-price { color: #00b4d8; font-weight: 800; font-size: 1.2rem; }

        /* --- DELETE BTN --- */
        .delete-btn { position: absolute; top: 15px; right: 15px; background: white; color: #ef4444; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; display: none; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 10; }
        .delete-btn.visible { display: flex; }
        .delete-btn:hover { background: #ef4444; color: white; }

        footer { background: #0a2342; color: white; text-align: center; padding: 20px; margin-top: auto; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 768px) { nav { flex-direction: column; gap: 15px; } .nav-group { width: 100%; flex-direction: column; } .search-box input { width: 100%; } }
    </style>
</head>
<body>

    <header>
        <nav>
            <a href="index.html" class="logo">KComputers</a>
            <div class="nav-group">
                <div class="nav-links">
                    <a href="index.html">Home</a>
                    <a href="products.html" class="active">Products</a>
                    <a href="leadership.html">Contact Us</a>
                </div>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Search products..." onkeyup="filterLocalProducts()">
                    <i class="fas fa-search"></i>
                </div>
                <button id="loginBtn" class="login-btn" onclick="adminLogin()">Admin Login</button>
                <button id="logoutBtn" class="login-btn logout-btn" onclick="adminLogout()">Logout</button>
            </div>
        </nav>
    </header>

    <main>
        <section>
            <h1 class="page-title">Product Catalog</h1>
            
            <div id="adminPanel" class="admin-panel">
                <h3><i class="fas fa-user-shield"></i> Admin: Add New Product</h3>
                <div class="input-group">
                    <input type="text" id="newProdName" placeholder="Product Name">
                    <input type="text" id="newProdPrice" placeholder="Price (e.g. $500)">
                </div>
                <div class="input-group">
                    <input type="text" id="newProdDesc" placeholder="Description">
                    <button class="btn-add" onclick="addProduct()">Add Product</button>
                </div>
            </div>

            <div class="product-grid" id="productGrid">
                <p style="text-align:center; width:100%;">Loading products...</p>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 KComputers Inc.</p>
    </footer>

    <script>
        // REPLACE THIS URL with your actual Render Backend URL
        // Example: 'https://kcomputers-backend.onrender.com/api/products'
        const API_URL = 'https://YOUR-RENDER-APP-NAME.onrender.com/api/products';
        
        let allProducts = []; // To store fetched data for searching
        let adminToken = null; // Stores password/token if logged in

        // 1. Fetch Products on Page Load
        async function fetchProducts() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Failed to fetch');
                
                allProducts = await response.json(); // Store DB data locally
                renderGrid(allProducts);
            } catch (error) {
                console.error(error);
                document.getElementById('productGrid').innerHTML = 
                    '<p style="text-align:center; color:red;">Error loading products. Is the server running?</p>';
            }
        }

        // 2. Render Grid
        function renderGrid(productsToRender) {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = "";

            if (productsToRender.length === 0) {
                grid.innerHTML = '<p style="text-align:center;">No products found.</p>';
                return;
            }

            productsToRender.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                // Only show delete button if adminToken exists
                const deleteBtnClass = adminToken ? 'delete-btn visible' : 'delete-btn';

                card.innerHTML = `
                    <button class="${deleteBtnClass}" onclick="deleteProduct('${product._id || product.id}')">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="product-img"><i class="fas fa-box-open"></i></div>
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <p class="product-desc">${product.desc || product.description}</p>
                        <div class="product-footer">
                            <span class="product-price">${product.price}</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // 3. Search (Client-side filtering of fetched data)
        function filterLocalProducts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allProducts.filter(p => 
                p.name.toLowerCase().includes(query) || 
                (p.desc && p.desc.toLowerCase().includes(query))
            );
            renderGrid(filtered);
        }

        // 4. Admin Login
        function adminLogin() {
            const password = prompt("Enter Admin Password:");
            if(password) {
                adminToken = password; // In a real app, you'd exchange this for a session token
                checkAdminView();
            }
        }

        function adminLogout() {
            adminToken = null;
            checkAdminView();
        }

        function checkAdminView() {
            const panel = document.getElementById('adminPanel');
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (adminToken) {
                panel.classList.add('visible');
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
            } else {
                panel.classList.remove('visible');
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
            }
            renderGrid(allProducts); // Re-render to show/hide delete buttons
        }

        // 5. Add Product (POST to Server)
        async function addProduct() {
            const name = document.getElementById('newProdName').value;
            const price = document.getElementById('newProdPrice').value;
            const desc = document.getElementById('newProdDesc').value;

            if(!name || !price) return alert("Name and Price required");

            const newProduct = { name, price, desc };

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'x-admin-password': adminToken // Sending password to backend for verification
                    },
                    body: JSON.stringify(newProduct)
                });

                if(res.ok) {
                    alert("Product Saved to Database!");
                    // Clear inputs and refresh data
                    document.getElementById('newProdName').value = "";
                    document.getElementById('newProdPrice').value = "";
                    document.getElementById('newProdDesc').value = "";
                    fetchProducts(); 
                } else {
                    alert("Error saving: " + await res.text());
                }
            } catch (err) {
                console.error(err);
                alert("Server connection failed");
            }
        }

        // 6. Delete Product (DELETE to Server)
        async function deleteProduct(id) {
            if(!confirm("Permanently delete this product from database?")) return;

            try {
                const res = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE',
                    headers: { 
                        'x-admin-password': adminToken 
                    }
                });

                if(res.ok) {
                    fetchProducts(); // Refresh list
                } else {
                    alert("Error deleting: " + await res.text());
                }
            } catch (err) {
                console.error(err);
            }
        }

        // Load data on startup
        fetchProducts();

    </script>
</body>
</html>